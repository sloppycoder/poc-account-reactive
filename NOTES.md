## quarkus project study notes

### Pros
1. runs postgresql with docker automatically.
2. swagger-ui included with smallrye-openapi dependency.
3. docker files included in the generated project.
4. resteasy-reactive controller does not use reactive datatypes, easier to migrate from existing services and compatible
   with swagger generated code.
5. uber.jar is 28M
6. opentracing is available with jaeger support.
7. prometheus metrics is available
8. flyway migration works (just add dependency and jdbc driver)
9. build native image works even without installing GraalVM. it uses docker image to build. 
10. jacoco coverage report works out-of-box. no setting required.

### Cons
1. generated pom.xml contains both resteasy and resteasy-reactive. can't run
2. tracing and metrics support for elastic is probably not available.
3. Oracle not supported by reactive sql driver.
4. first implementation of data retrieve requires change in API generated by Swagger. from Response to Uni<Response>
5. build docker image is slow.

### Issues
1. how does image build interact with JIB? JIB is much faster. the build depends on docker daemon? JIB doesn't.
2. swagger.io generated code triggers ISO8601Utils is deprecated warning. (code removed)
3. wny does swagger generate so many classes? need to tweak the config.



### appendices
native image build output
```text
[INFO] [io.quarkus.deployment.pkg.steps.NativeImageBuildStep] Running Quarkus native-image plugin on GraalVM Version 21.0.0.2 (Java Version 11.0.10+8-jvmci-21.0-b06)
[INFO] [io.quarkus.deployment.pkg.steps.NativeImageBuildRunner] docker run --env LANG=C --user 1000:1000 --rm -v /home/lee/Projects/git/accounts-reactive/target/accounts-reactive-1.0.0-SNAPSHOT-native-image-source-jar:/project:z quay.io/quarkus/ubi-quarkus-native-image:21.0-java11 -J-Dsun.nio.ch.maxUpdateArraySize=100 -J-Djava.util.logging.manager=org.jboss.logmanager.LogManager -J-DCoordinatorEnvironmentBean.transactionStatusManagerEnable=false -J-Dvertx.logger-delegate-factory-class-name=io.quarkus.vertx.core.runtime.VertxLogDelegateFactory -J-Dvertx.disableDnsResolver=true -J-Dio.netty.leakDetection.level=DISABLED -J-Dio.netty.allocator.maxOrder=1 -J-Duser.language=en -J-Duser.country=SG -J-Dfile.encoding=UTF-8 --initialize-at-build-time= -H:InitialCollectionPolicy=com.oracle.svm.core.genscavenge.CollectionPolicy\$BySpaceAndTime -H:+JNI -H:+AllowFoldMethods -jar accounts-reactive-1.0.0-SNAPSHOT-runner.jar -H:FallbackThreshold=0 -H:+ReportExceptionStackTraces -H:-AddAllCharsets -H:EnableURLProtocols=http,https --enable-all-security-services -H:NativeLinkerOption=-no-pie --no-server -H:-UseServiceLoaderFeature -H:+StackTrace accounts-reactive-1.0.0-SNAPSHOT-runner
[accounts-reactive-1.0.0-SNAPSHOT-runner:24]    classlist:   3,948.71 ms,  1.70 GB
[accounts-reactive-1.0.0-SNAPSHOT-runner:24]        (cap):     505.51 ms,  1.70 GB
[accounts-reactive-1.0.0-SNAPSHOT-runner:24]        setup:   1,833.66 ms,  1.70 GB
03:19:01,532 INFO  [org.hib.val.int.uti.Version] HV000001: Hibernate Validator 6.2.0.Final
03:19:38,910 INFO  [org.jbo.threads] JBoss Threads version 3.2.0.Final
[accounts-reactive-1.0.0-SNAPSHOT-runner:24]     (clinit):   1,410.20 ms,  6.09 GB
[accounts-reactive-1.0.0-SNAPSHOT-runner:24]   (typeflow):  40,522.85 ms,  6.09 GB
[accounts-reactive-1.0.0-SNAPSHOT-runner:24]    (objects):  50,810.15 ms,  6.09 GB
[accounts-reactive-1.0.0-SNAPSHOT-runner:24]   (features):   1,859.50 ms,  6.09 GB
[accounts-reactive-1.0.0-SNAPSHOT-runner:24]     analysis:  97,986.34 ms,  6.09 GB
[accounts-reactive-1.0.0-SNAPSHOT-runner:24]     universe:   3,700.27 ms,  6.09 GB
[accounts-reactive-1.0.0-SNAPSHOT-runner:24]      (parse):  13,690.56 ms,  6.06 GB
[accounts-reactive-1.0.0-SNAPSHOT-runner:24]     (inline):  12,719.16 ms,  6.94 GB
[accounts-reactive-1.0.0-SNAPSHOT-runner:24]    (compile):  60,985.80 ms,  6.82 GB
[accounts-reactive-1.0.0-SNAPSHOT-runner:24]      compile:  91,576.16 ms,  6.82 GB
[accounts-reactive-1.0.0-SNAPSHOT-runner:24]        image:  10,719.68 ms,  6.80 GB
[accounts-reactive-1.0.0-SNAPSHOT-runner:24]        write:   1,270.01 ms,  6.80 GB
[accounts-reactive-1.0.0-SNAPSHOT-runner:24]      [total]: 211,342.62 ms,  6.80 GB
[INFO] [io.quarkus.deployment.QuarkusAugmentor] Quarkus augmentation completed in 302764ms
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  05:17 min
[INFO] Finished at: 2021-06-06T11:22:30+08:00
[INFO] ------------------------------------------------------------------------

ls ...

drwxrwxr-x 3 lee lee     4096 Jun  6 11:22 accounts-reactive-1.0.0-SNAPSHOT-native-image-source-jar
-rwxr-xr-x 1 lee lee 97990472 Jun  6 11:22 accounts-reactive-1.0.0-SNAPSHOT-runner

```
